<!DOCTYPE html>
<html>
  <head></head>
  <body>

<h1>Testing secure payment and username retrival from database</h1>
    
<p style="text-align: center;"></p>
<label>Enter and leave the payAccess key to unlock Observations 5-21:</label><input id="username" type="text" value="" placeholder="username" rows="1" cols="50" style='text-align: center; width: 400px;'>
<button id="search_username" onclick="search_username()" style="display:block">search_username</button>
<button id="add_username" onclick="add_username()" style="display:block">add_username</button>
<button id="view_filedatabase" onclick="view_filedatabase()" style="display:block">view_filedatabase</button>
<button id="remove_username" onclick="remove_username()" style="display:block">remove_username</button>
<br>
<div id="notification"></div>
<div id="error"></div>
<div id="response"></div>

<!-- Insert library_window_crypto_subtle.js CDN library -->
<script type="module" src="./index.js"></script>

<!-- --------------------------------------------------- -->
    
<script>

// ------------------------------------------------
  
window.addEventListener('beforeunload', function() {
    window.location.href = window.location.href + '?nocache=' + new Date().getTime();
});

// ------------------------------------------------

async function search_username() {
	
	var RepoAobj = {};
  
	RepoAobj.repoOwner = "CodeSolutions2";
	RepoAobj.filename = "cb.txt";
	RepoAobj.repoA_name = "webapp_book_observations";
	RepoAobj.repoB_name = "frontend_backend_message_passing_central_repository_v1";
	RepoAobj.input_text = document.getElementById("username").value+"|"+RepoAobj.repoA_name;
	RepoAobj.foldername = "webappb";
  
	// const obj = await search_username_to_file_database(RepoAobj);
	// OR
	const classObj = new encrypted_CRUD_file_database(RepoAobj);
	const obj = await classObj.search_username_to_file_database();

	document.getElementById("response").innerHTML = "Your entered username: "+document.getElementById("username").value+", is "+obj.query_search_result+" in the file database.";
		
}
	
// ------------------------------------------------

async function add_username() {
	
	var RepoAobj = {};
  
	RepoAobj.repoOwner = "CodeSolutions2";
	RepoAobj.filename = "cb.txt";
	RepoAobj.repoA_name = "webapp_book_observations";
	RepoAobj.repoB_name = "frontend_backend_message_passing_central_repository_v1";
	RepoAobj.input_text = document.getElementById("username").value+"|"+RepoAobj.repoA_name;
	RepoAobj.foldername = "webappb";
  
	// const obj = await add_username_to_file_database(RepoAobj);
	// OR
	const classObj = new encrypted_CRUD_file_database(RepoAobj);
	const obj = await classObj.add_username_to_file_database();

	document.getElementById("response").innerHTML = "Your entered username: "+document.getElementById("username").value+", is "+obj.query_search_result+" in the file database. "+obj.query_insert_result;
		
}
    
// ------------------------------------------------

async function view_filedatabase() {
	
	var RepoAobj = {};
  
	RepoAobj.repoOwner = "CodeSolutions2";
	RepoAobj.filename = "cb.txt";
	RepoAobj.repoA_name = "webapp_book_observations";
	RepoAobj.repoB_name = "frontend_backend_message_passing_central_repository_v1";
	RepoAobj.input_text = document.getElementById("username").value+"|"+RepoAobj.repoA_name;
	RepoAobj.foldername = "webappb";
  
	// const obj = await view_file_database(RepoAobj);
	// OR
	const classObj = new encrypted_CRUD_file_database(RepoAobj);
	const obj = await classObj.view_file_database();

	document.getElementById("response").innerHTML = obj.query_view_result;
	
}
    
// ------------------------------------------------

async function remove_username() {
	
	var RepoAobj = {};
  
	RepoAobj.repoOwner = "CodeSolutions2";
	RepoAobj.filename = "cb.txt";
	RepoAobj.repoA_name = "webapp_book_observations";
	RepoAobj.repoB_name = "frontend_backend_message_passing_central_repository_v1";
	RepoAobj.call_type = "insert_username";  // File database functions: insert_username, comparator_username_search
	RepoAobj.input_text = document.getElementById("username").value+"|"+RepoAobj.call_type;
	RepoAobj.foldername = "webappb";
  
	// const obj = await delete_username_from_file_database(RepoAobj);
	// OR
	const classObj = new encrypted_CRUD_file_database(RepoAobj);
	const obj = await classObj.delete_username_from_file_database();

	document.getElementById("response").innerHTML = "Your entered username: "+document.getElementById("username").value+", is "+obj.query_search_result+" in the file database. "+obj.query_delete_result;
		
}

  
    
  </script>

  </body>
</html>
